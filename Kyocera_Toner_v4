
from datetime import datetime
from pysnmp.entity.rfc3413.oneliner import cmdgen
from email import message
import telebot
import time
from telebot import types
from datetime import datetime



bot = telebot.TeleBot("5698564131:AAHJHQDjKH8cq4_dyWHsSH-6_DHmld1FJtU") # You can set parse_mode by default. HTML or MARKDOWN
ChatID="@vs_allertlocal"    #Это Ид чата телеграмм в который отправляются данные
ustavka=1                   #Это уставка отвечающая за уровень тонера при коротом цикличная проверка будет отправлять данные в канал
sleptime=300                 #Это уставка отвечающая за время ожидания следующего опроса при цикличной проверке

@bot.message_handler(commands=['start'])
def start(message):
    mess = f'Привет, {message.from_user.first_name} {message.from_user.last_name}'
    
    print(f"к боту подключился {message.from_user.first_name} {message.from_user.last_name}")
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    #btn1 = types.KeyboardButton("Проверить состояние тонера")
    btn1 = types.KeyboardButton("Проверить состояние тонера")
    btn2 = types.KeyboardButton("Цикличная проверка")
    markup.add(btn1, btn2)
    #markup.add(btn1)
    bot.send_message(message.chat.id, text=f'{mess}, на текущий момент я могу показать только состояние тонера МФУ', reply_markup=markup)


@bot.message_handler(content_types=['text'])
def startfnc(message):
    #if (message.text == "Запустить функцию цикличной проверки состояния тонера"):
    #    test()
    #elif (message.text == "Проверить состояние тонера"):
    #    smnp(message)
    #else:
    #    print("111")
    
        if (message.text == "Проверить состояние тонера"):
            smnp(message)
        elif (message.text == "Цикличная проверка"):
            while True:
                test()
                time.sleep(sleptime)
        
def test():
    
        currenttime=datetime.now()
        
        #print(f"Проверка состояния произвелась: {currenttime} ")
        iptable = ['172.28.150.240', '172.28.150.241','172.28.150.242','172.28.150.243','172.28.150.245', '172.28.150.246']
        for ipaddr in iptable:
            cmdGen = cmdgen.CommandGenerator()  
            ipaddr=str(ipaddr)
            #print(f"Устройство опрошено в {currenttime} Адрес устройства: {ipaddr}")
            errorIndication, errorStatus, errorIndex, varBinds = cmdGen.getCmd(
                cmdgen.CommunityData('public'),
                cmdgen.UdpTransportTarget((ipaddr, 161)),
                #('1.3.6.1.2.1.25.3.5.1.1.1'),
                ('1.3.6.1.2.1.43.11.1.1.9.1.1'),    # Summa index 0     SNMPv2-SMI::mib-2.43.11.1.1.9.1.1 = 2100
                ('1.3.6.1.2.1.43.11.1.1.8.1.1'),    # Summa index 1     SNMPv2-SMI::mib-2.43.11.1.1.8.1.1 = 35000
                ('iso.3.6.1.2.1.43.11.1.1.6.1.1'),  # stroka index 0    SNMPv2-SMI::mib-2.43.11.1.1.6.1.1 = TK-7225
                ('iso.3.6.1.2.1.43.12.1.1.4.1.1'),  # stroka index 1    SNMPv2-SMI::mib-2.43.12.1.1.4.1.1 = black
                ('iso.3.6.1.2.1.43.5.1.1.16.1'),    # stroka index 2    SNMPv2-SMI::mib-2.43.5.1.1.16.1 = TASKalfa 4012i
                ('iso.3.6.1.2.1.43.5.1.1.17.1'),    # stroka index 3    SNMPv2-SMI::mib-2.43.5.1.1.17.1 = R3T9721512
                ('iso.3.6.1.2.1.43.11.1.1.6.1.4'),  # stroka index 4    iso.3.6.1.2.1.43.11.1.1.6.1.4 = STRING: "TK-8345K" 2553ci Black 
                ('iso.3.6.1.2.1.43.12.1.1.4.1.4'),  # stroka index 5    stroka index 5 iso.3.6.1.2.1.43.12.1.1.4.1.4 = STRING: "black"  2553ci Black
                ('iso.3.6.1.2.1.43.11.1.1.9.1.4'),  # Summa index 2     iso.3.6.1.2.1.43.11.1.1.9.1.4 = INTEGER: 1000    BLACK
                ('iso.3.6.1.2.1.43.11.1.1.8.1.4'),  # Summa index 3     iso.3.6.1.2.1.43.11.1.1.8.1.4 = INTEGER: 20000   BLACK
                ('iso.3.6.1.2.1.43.11.1.1.9.1.3'),  # Summa index 4     iso.3.6.1.2.1.43.11.1.1.9.1.3 = INTEGER: 7920    YELLOW
                ('iso.3.6.1.2.1.43.11.1.1.8.1.3'),  # Summa index 5     iso.3.6.1.2.1.43.11.1.1.8.1.3 = INTEGER: 12000   YELLOW
                ('iso.3.6.1.2.1.43.11.1.1.9.1.2'),  # Summa index 6     iso.3.6.1.2.1.43.11.1.1.9.1.2 = INTEGER: -2      MAGENTA
                ('iso.3.6.1.2.1.43.11.1.1.8.1.2'),  # Summa index 7     iso.3.6.1.2.1.43.11.1.1.8.1.2 = INTEGER: -2      MAGENTA            
                ('iso.3.6.1.2.1.43.12.1.1.4.1.3'),  # stroka index 6    iso.3.6.1.2.1.43.12.1.1.4.1.3 = STRING: "yellow"
                ('iso.3.6.1.2.1.43.11.1.1.6.1.3'),  # stroka index 7    iso.3.6.1.2.1.43.11.1.1.6.1.3 = STRING: "TK-8345Y"
                ('iso.3.6.1.2.1.43.12.1.1.4.1.2'),  # stroka index 8    iso.3.6.1.2.1.43.12.1.1.4.1.2 = STRING: "magenta"
                ('iso.3.6.1.2.1.43.11.1.1.6.1.2'),  # stroka index 9    iso.3.6.1.2.1.43.11.1.1.6.1.2 = STRING: "TK-8345M"
                ('iso.3.6.1.2.1.1.6.0')             # stroka index 10   iso.3.6.1.2.1.1.6.0 = STRING: местоположение
                )    

            summa=[]
            stroka=[]
            for name, val in varBinds:
                #print('%s = %s' % (name.prettyPrint(), str(val)))
                try:
                    summa.append(int(val))
                    
                except ValueError:
                    stroka.append(str(val))
                    continue
                    
                #print(name.prettyPrint())
                #print(val.prettyPrint())
            #print(summa)
            #print(stroka)
            
            #ChatID="@VS_allert_local"
            
            try:
                if stroka[2] == "TASKalfa 4012i":
                    try:
                        if stroka[0] == "": 
                            toner="Черный катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-7225"
                        else:
                            if stroka[16] == "kab_31":
                                mesto = "Черно-белый напротив 31 кабинета "
                            elif stroka[16] == "kab_19":
                                mesto = "Черно-белый напротив 19 кабинета "
                            elif stroka[16] == "kab_33":
                                mesto = "Черно-белый напротив 33 кабинета "
                            elif stroka[16] == "kab_28":
                                mesto = "Черно-белый напротив 28 кабинета "
                            else: 
                                mesto="не указано"
                            toner=100*(summa[0]/summa[1]) #black 4012i
                            #print("\n________Выходные данные___________\n")
                            #print(f"МФУ {stroka[2]} {stroka[3]} ip-address: {ipaddr} \n {stroka[1]} {stroka[0]} = {toner} %")
                            #bot.send_message(message.chat.id, f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджа: \n {stroka[1]} {stroka[0]} = {toner} %", parse_mode='') # вывод значения строки в окно  
                    except IndexError:
                        print("Была обнаружена ошибка IndexError при опросе 121 строка")
                        #bot.send_message(message.chat.id, f"ip-address: {ipaddr} нет ответа по SNMP", parse_mode='') # вывод значения строки в окно  
                        continue
                    if toner <= ustavka:
                        #bot.send_message(chat_id='@VS_allert_local', text=f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n  УРОВЕНЬ ТОНЕРА МЕНЕЕ 1%  " , parse_mode='')
                        print("\n #########################################################################################################################################") 
                        print(f"Устройство опрошено в {currenttime}")
                        print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ТОНЕРА МЕНЕЕ {ustavka}% !!!! ")
                        bot.send_message(chat_id=ChatID, text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЧЕРНОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                        #bot.send_message(chat_id="@vsaupprintersallbot", text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЧЕРНОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                        print("######################################################################################################################################### \n") 
                    else:
                        print("######################################################################################################################################### \n") 
                        print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ТОНЕРА В НОРМЕ !!!! ")
                        print("\n #########################################################################################################################################")
                        #print(f"Устройство опрошено в {currenttime} Адрес устройства: {ipaddr}")
                        #print(f"Тонер в норме МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} ")
                        #bot.send_message(chat_id='@VS_allert_local', text=f"Тонер в норме МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} ", parse_mode='')
                        #print("######################################################################################################################################### \n") 
                elif stroka[2] == "TASKalfa 2553ci":
                    #print(stroka[2])
                    try:
                        if stroka[0] == "":
                            #print(stroka[0]) 
                            toner="Голубой катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345C"
                        else:
                            toner=100*(summa[0]/summa[1]) #cyan 2553ci
                            #print(stroka[0]) 
                        if stroka[4] == "":                      
                            tonerblack2553="Черный катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345K"
                        else:    
                            tonerblack2553=100*((summa[2]/summa[3]))
                        
                        if stroka[7] == "":
                            toneryellow2553="Желтый катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345Y"
                        else:
                            toneryellow2553=100*((summa[4]/summa[5]))
                        if stroka[9] == "": 
                            tonermagenta2553="Катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345M" 
                        else:
                            tonermagenta2553=100*((summa[6]/summa[7]))
                        if stroka[10] == "kab_31":
                            mesto = "Цветной напротив 31 кабинета "
                        elif stroka[10] == "kab_19":
                            mesto = "Цветной напротив 19 кабинета "
                        else:
                            mesto="не указано"
                        
                        
                        
                        if toner <= ustavka:
                            #bot.send_message(chat_id='@VS_allert_local', text=f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n  УРОВЕНЬ ТОНЕРА МЕНЕЕ 1%  " , parse_mode='')
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ГОЛУБОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! ")
                            bot.send_message(chat_id=ChatID, text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ГОЛУБОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                            print("######################################################################################################################################### \n") 
                        elif toner == "Голубой катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345C":
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! {toner} ")
                            print("######################################################################################################################################### \n") 
                        else:
                            print("######################################################################################################################################### \n")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ГОЛУБОГО ТОНЕРА В НОРМЕ !!!! ")
                            print("\n ######################################################################################################################################### \n")
                            
                        if tonerblack2553 <= ustavka:
                            #bot.send_message(chat_id='@VS_allert_local', text=f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n  УРОВЕНЬ ТОНЕРА МЕНЕЕ 1%  " , parse_mode='')
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЧЕРНОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! ")
                            bot.send_message(chat_id=ChatID, text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЧЕРНОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                            print("######################################################################################################################################### \n") 
                        elif tonerblack2553 == "Черный катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345K":
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! {tonerblack2553} ")
                            print("######################################################################################################################################### \n") 
                        else:
                            print("\n #########################################################################################################################################")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЧЕРНОГО ТОНЕРА В НОРМЕ !!!! ")
                            print("\n ######################################################################################################################################### \n")
                        if toneryellow2553 <= ustavka:
                            #bot.send_message(chat_id='@VS_allert_local', text=f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n  УРОВЕНЬ ТОНЕРА МЕНЕЕ 1%  " , parse_mode='')
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЖЕЛТОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! ")
                            bot.send_message(chat_id=ChatID, text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЖЕЛТОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                            print("######################################################################################################################################### \n") 
                        elif toneryellow2553 == "Желтый катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345Y":
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! {toneryellow2553} ")
                            print("######################################################################################################################################### \n") 
                        else:
                            print("######################################################################################################################################### \n")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ЖЕЛТОГО ТОНЕРА В НОРМЕ !!!! ")
                            print("\n ######################################################################################################################################### \n")
                            
                        if tonermagenta2553 <= ustavka:
                            #bot.send_message(chat_id='@VS_allert_local', text=f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n  УРОВЕНЬ ТОНЕРА МЕНЕЕ 1%  " , parse_mode='')
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ФИОЛЕТОВОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! ")
                            bot.send_message(chat_id=ChatID, text=(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ФИОЛЕТОВОГО ТОНЕРА МЕНЕЕ {ustavka}% !!!! "), parse_mode='') # вывод значения строки в окно  
                            print("######################################################################################################################################### \n") 
                        elif tonermagenta2553 == "Розовый катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345M":
                            print("\n #########################################################################################################################################") 
                            print(f"Устройство опрошено в {currenttime}")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! {tonermagenta2553} ")
                            print("######################################################################################################################################### \n") 
                        else:
                            print("######################################################################################################################################### \n")
                            print(f"МФУ {stroka[2]} {stroka[3]} \n Местоположение: {mesto} \n ip-адресом: {ipaddr} \n !!!! УРОВЕНЬ ФИОЛЕТОВОГО ТОНЕРА В НОРМЕ !!!! ")
                            print("\n #########################################################################################################################################")                  
                        #print("\n________Выходные данные___________\n")
                        #print(f"Уровень тонера МФУ {mesto} {stroka[2]} {stroka[3]} ip-address: {ipaddr} \n {stroka[1]} {stroka[0]} = {toner} % \n {stroka[5]} {stroka[4]} = {tonerblack2553} \n {stroka[6]} {stroka[7]} = {toneryellow2553} \n {stroka[8]} {stroka[9]} = {tonermagenta2553} ")
                        #bot.send_message(message.chat.id, f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджей: \n {stroka[5]} {stroka[4]} = {tonerblack2553} % \n {stroka[1]} {stroka[0]} = {toner} %  \n {stroka[6]} {stroka[7]} = {toneryellow2553} % \n {stroka[8]} {stroka[9]} = {tonermagenta2553} %", parse_mode='') # вывод значения строки в окно  
                        continue
                    except:
                        print("Ошибка в ответе по SNMP цветной МФУ")
                            
                        #bot.send_message(message.chat.id, f"ip-address: {ipaddr} Ошибка в ответе по SNMP цветной МФУ", parse_mode='') # вывод значения строки в окно   
                        continue
                    #print("######################################################################################################################################### \n")              
            except IndexError:
                print("Была обнаружена ошибка IndexError при опросе 248 строка")
                #bot.send_message(message.chat.id, f"ip-address: {ipaddr} нет ответа по SNMP", parse_mode='') # вывод значения строки в окно 
                continue    
        #else:
            #bot.send_message(message.chat.id, text="На такую комманду я не запрограммировал..") 
            #print("На такую комманду я не запрограммирован..")
        #await asyncio.sleep(3) 
        #time.sleep(10)  
        
def smnp(message):
    #while True:
    currenttime=datetime.now()
    bot.send_message(message.chat.id, f"Проверка состояниея произвелась: {currenttime} ", parse_mode='') # вывод значения строки в окно  
    if (message.text == "Проверить состояние тонера"):
        iptable = ['172.28.150.240', '172.28.150.241','172.28.150.242','172.28.150.243','172.28.150.245', '172.28.150.246']
        for ipaddr in iptable:
            print("\n #########################################################################################################################################") 
            cmdGen = cmdgen.CommandGenerator()  
            ipaddr=str(ipaddr)
            print(f"Адрес устройства: {ipaddr}")
            errorIndication, errorStatus, errorIndex, varBinds = cmdGen.getCmd(
                cmdgen.CommunityData('public'),
                cmdgen.UdpTransportTarget((ipaddr, 161)),
                #('1.3.6.1.2.1.25.3.5.1.1.1'),
                ('1.3.6.1.2.1.43.11.1.1.9.1.1'),    # Summa index 0     SNMPv2-SMI::mib-2.43.11.1.1.9.1.1 = 2100
                ('1.3.6.1.2.1.43.11.1.1.8.1.1'),    # Summa index 1     SNMPv2-SMI::mib-2.43.11.1.1.8.1.1 = 35000
                ('iso.3.6.1.2.1.43.11.1.1.6.1.1'),  # stroka index 0    SNMPv2-SMI::mib-2.43.11.1.1.6.1.1 = TK-7225
                ('iso.3.6.1.2.1.43.12.1.1.4.1.1'),  # stroka index 1    SNMPv2-SMI::mib-2.43.12.1.1.4.1.1 = black
                ('iso.3.6.1.2.1.43.5.1.1.16.1'),    # stroka index 2    SNMPv2-SMI::mib-2.43.5.1.1.16.1 = TASKalfa 4012i
                ('iso.3.6.1.2.1.43.5.1.1.17.1'),    # stroka index 3    SNMPv2-SMI::mib-2.43.5.1.1.17.1 = R3T9721512
                ('iso.3.6.1.2.1.43.11.1.1.6.1.4'),  # stroka index 4    iso.3.6.1.2.1.43.11.1.1.6.1.4 = STRING: "TK-8345K" 2553ci Black 
                ('iso.3.6.1.2.1.43.12.1.1.4.1.4'),  # stroka index 5    stroka index 5 iso.3.6.1.2.1.43.12.1.1.4.1.4 = STRING: "black"  2553ci Black
                ('iso.3.6.1.2.1.43.11.1.1.9.1.4'),  # Summa index 2     iso.3.6.1.2.1.43.11.1.1.9.1.4 = INTEGER: 1000    BLACK
                ('iso.3.6.1.2.1.43.11.1.1.8.1.4'),  # Summa index 3     iso.3.6.1.2.1.43.11.1.1.8.1.4 = INTEGER: 20000   BLACK
                ('iso.3.6.1.2.1.43.11.1.1.9.1.3'),  # Summa index 4     iso.3.6.1.2.1.43.11.1.1.9.1.3 = INTEGER: 7920    YELLOW
                ('iso.3.6.1.2.1.43.11.1.1.8.1.3'),  # Summa index 5     iso.3.6.1.2.1.43.11.1.1.8.1.3 = INTEGER: 12000   YELLOW
                ('iso.3.6.1.2.1.43.11.1.1.9.1.2'),  # Summa index 6     iso.3.6.1.2.1.43.11.1.1.9.1.2 = INTEGER: -2      MAGENTA
                ('iso.3.6.1.2.1.43.11.1.1.8.1.2'),  # Summa index 7     iso.3.6.1.2.1.43.11.1.1.8.1.2 = INTEGER: -2      MAGENTA            
                ('iso.3.6.1.2.1.43.12.1.1.4.1.3'),  # stroka index 6    iso.3.6.1.2.1.43.12.1.1.4.1.3 = STRING: "yellow"
                ('iso.3.6.1.2.1.43.11.1.1.6.1.3'),  # stroka index 7    iso.3.6.1.2.1.43.11.1.1.6.1.3 = STRING: "TK-8345Y"
                ('iso.3.6.1.2.1.43.12.1.1.4.1.2'),  # stroka index 8    iso.3.6.1.2.1.43.12.1.1.4.1.2 = STRING: "magenta"
                ('iso.3.6.1.2.1.43.11.1.1.6.1.2'),  # stroka index 9    iso.3.6.1.2.1.43.11.1.1.6.1.2 = STRING: "TK-8345M"
                ('iso.3.6.1.2.1.1.6.0')             # stroka index 10   iso.3.6.1.2.1.1.6.0 = STRING: местоположение
                )    

            summa=[]
            stroka=[]
            for name, val in varBinds:
                print('%s = %s' % (name.prettyPrint(), str(val)))
                try:
                    summa.append(int(val))
                    
                except ValueError:
                    stroka.append(str(val))
                    #temp1=str(val)
                    #if temp1 == "":
                    #   stroka.append("Н/Д")
                    #   continue     
                    #else:
                    #    stroka.append(str(val))
                    continue
                    
                #print(name.prettyPrint())
                #print(val.prettyPrint())
            print(summa)
            print(stroka)
            #print(stroka[16])
            try:
                if stroka[2] == "TASKalfa 4012i":
                    try:
                        if stroka[0] == "": 
                            toner="Черный катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-7225"
                        else:
                            if stroka[16] == "kab_31":
                                mesto = "Черно-белый напротив 31 кабинета "
                            elif stroka[16] == "kab_19":
                                mesto = "Черно-белый напротив 19 кабинета "
                            elif stroka[16] == "kab_33":
                                mesto = "Черно-белый напротив 33 кабинета "
                            elif stroka[16] == "kab_28":
                                mesto = "Черно-белый напротив 28 кабинета "
                            else: 
                                mesto="не указано"
                            toner=100*(summa[0]/summa[1]) #black 4012i
                            print("\n________Выходные данные___________\n")
                            print(f"МФУ {stroka[2]} {stroka[3]} ip-address: {ipaddr} \n {stroka[1]} {stroka[0]} = {toner} %")
                            bot.send_message(message.chat.id, f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджа: \n {stroka[1]} {stroka[0]} = {toner} %", parse_mode='') # вывод значения строки в окно 
                            bot.send_message(chat_id=ChatID, text=f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджа: \n {stroka[1]} {stroka[0]} = {toner} %", parse_mode='') # вывод значения строки в окно   
                    except IndexError:
                        print("Ошибка в ответе по SNMP ЧБ МФУ")
                        bot.send_message(message.chat.id, f"ip-address: {ipaddr} нет ответа по SNMP", parse_mode='') # вывод значения строки в окно  
                        continue
                    print("######################################################################################################################################### \n") 
                elif stroka[2] == "TASKalfa 2553ci":
                    try:
                        if stroka[0] == "": 
                            toner="Голубой катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345C"
                        else:
                            toner=100*(summa[0]/summa[1]) #cyan 2553ci
                        if stroka[4] == "":                      
                            tonerblack2553="Черный катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345K"
                        else:    
                            tonerblack2553=100*((summa[2]/summa[3]))
                        
                        if stroka[7] == "":
                            toneryellow2553="Желтый катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345Y"
                        else:
                            toneryellow2553=100*((summa[4]/summa[5]))
                        if stroka[9] == "": 
                            tonermagenta2553="Катридж не идентицифирован, данные по нему отсутствуют, оригинальный картридж: TK-8345M" 
                        else:
                            tonermagenta2553=100*((summa[6]/summa[7]))
                        if stroka[10] == "kab_31":
                            mesto = "Цветной напротив 31 кабинета "
                        elif stroka[10] == "kab_19":
                            mesto = "Цветной напротив 19 кабинета "
                        else:
                            mesto="не указано"
                        print("\n________Выходные данные___________\n")
                        print(f"Уровень тонера МФУ {mesto} {stroka[2]} {stroka[3]} ip-address: {ipaddr} \n {stroka[1]} {stroka[0]} = {toner} % \n {stroka[5]} {stroka[4]} = {tonerblack2553} \n {stroka[6]} {stroka[7]} = {toneryellow2553} \n {stroka[8]} {stroka[9]} = {tonermagenta2553} ")
                        bot.send_message(message.chat.id, f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджей: \n {stroka[5]} {stroka[4]} = {tonerblack2553} % \n {stroka[1]} {stroka[0]} = {toner} %  \n {stroka[6]} {stroka[7]} = {toneryellow2553} % \n {stroka[8]} {stroka[9]} = {tonermagenta2553} %", parse_mode='') # вывод значения строки в окно  
                        bot.send_message(chat_id=ChatID, text=f"МФУ Kyocera {stroka[2]} \n Местоположение: {mesto} \n Имя хоста: {stroka[3]} \n ip-address: {ipaddr} \n Состояние картриджей: \n {stroka[5]} {stroka[4]} = {tonerblack2553} % \n {stroka[1]} {stroka[0]} = {toner} %  \n {stroka[6]} {stroka[7]} = {toneryellow2553} % \n {stroka[8]} {stroka[9]} = {tonermagenta2553} %", parse_mode='') # вывод значения строки в окно  
                    except:
                        print("Ошибка в ответе по SNMP цветной МФУ")
                            
                        bot.send_message(message.chat.id, f"ip-address: {ipaddr} Ошибка в ответе по SNMP цветной МФУ", parse_mode='') # вывод значения строки в окно   
                        continue
                    print("######################################################################################################################################### \n")              
            except IndexError:
                print("Нет ответа по SNMP")
                bot.send_message(message.chat.id, f"ip-address: {ipaddr} нет ответа по SNMP", parse_mode='') # вывод значения строки в окно 
                continue    
    else:
        bot.send_message(message.chat.id, text="На такую комманду я не запрограммировал..") 
    #time.sleep(10)             


bot.polling(non_stop=True)



